---

- name: Debug ansible_facts
  debug:
    var: ansible_facts

- name: Install Windows Subsystem for Linux (wsl2)
  win_command: wsl --status
  register: wsl_status
  ignore_errors: yes
  changed_when: no

- name: Debug WSL install status
  debug:
    var: wsl_status

- debug:
    msg: "{{ wsl_status.stdout | to_yaml }}"

- name: Install Windows Subsystem for Linux (wsl2)
  win_command: wsl --install
  register: wsl_install
  when:
    - wsl_status is failed

- name: Debug WSL install status
  debug:
    var: wsl_install

- name: Reboot after WSL installation
  win_reboot:
  when: wsl_install is changed
