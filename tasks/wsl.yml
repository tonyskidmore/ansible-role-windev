---

- name: Debug ansible_facts
  debug:
    var: ansible_facts

- name: Install Windows Subsystem for Linux (wsl2)
  win_command: wsl --status
  register: wsl_status
  ignore_errors: yes
  changed_when: no

- name: Debug WSL install status
  debug:
    var: wsl_status

- debug:
    msg: "{{ wsl_status.stdout | to_yaml }}"

# all-in-one method
# Install WSL with a single command now available in Windows 10 version 2004 and higher
# https://devblogs.microsoft.com/commandline/install-wsl-with-a-single-command-now-available-in-windows-10-version-2004-and-higher/
# - name: Install Windows Subsystem for Linux (wsl2)
#   win_command: wsl --install
#   register: wsl_install
#   when:
#     - wsl_status is failed

# - name: Debug WSL install status
#   debug:
#     var: wsl_install

# - name: Reboot after WSL installation
#   win_reboot:
#   when: wsl_install is changed

- name: Enable WSL Windows features
  ansible.windows.win_optional_feature:
    name: "{{ item }}"
    state: present

  register: win_feature
  loop: "{{ win_features }}"

- name: Reboot if WSL feature installation requires it
  ansible.windows.win_reboot:
  when: win_feature.reboot_required

# - name: WSL download block
#   block:

#   always:
